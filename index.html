<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coffee Shaky</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
  /* --------------  CSS (unchanged except typo fixes) -------------- */
  body{margin:0;padding:0;direction:rtl;
       background:url('coffee-bg.png') no-repeat center/cover fixed;
       font-family:'Montserrat',sans-serif;color:#4e342e}
  .container{max-width:800px;margin:30px auto;
      background:rgba(255,255,255,.95);border-radius:12px;
      box-shadow:0 6px 15px rgba(0,0,0,.1);padding:30px}
  h1{text-align:center;font-size:3em;margin-bottom:20px;color:#6f4e37;
      text-shadow:1px 1px 3px rgba(0,0,0,.1)}
  .coffee-options{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin-bottom:30px}
  .coffee-card{background:#faf3ee;border:2px solid transparent;border-radius:10px;
      width:150px;text-align:center;cursor:pointer;padding:15px;
      transition:transform .3s,border-color .3s;
      box-shadow:0 4px 8px rgba(0,0,0,.08)}
  .coffee-card:hover{transform:translateY(-5px)}
  .coffee-card.selected{border-color:#6f4e37}
  .coffee-icon img{width:50px;height:50px;display:block;margin:0 auto}
  .coffee-card[data-coffee="Espresso"] .coffee-icon img{width:70px;height:70px}
  .coffee-card p{margin:0;font-weight:500;font-size:1.1em}
  form{margin-bottom:20px}.form-group{margin-bottom:15px}
  label{display:block;margin-bottom:8px;font-weight:500}
  input[type="text"],textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:1em}
  textarea{resize:vertical;min-height:60px}
  button{width:100%;padding:12px;background:#6f4e37;color:#fff;border:none;border-radius:5px;font-size:1.2em;cursor:pointer;transition:background .3s}
  button:hover{background:#5a3e2b}
  .action-button{width:auto;padding:8px 16px;margin:10px 5px;background:#6f4e37;color:#fff;border:none;border-radius:5px;cursor:pointer}
  .delete-button{background:#b71c1c}.delete-button:hover{background:#d32f2f}
  h2{text-align:center;margin-top:30px;font-size:1.8em;color:#6f4e37}
  #orderQueue{list-style:none;padding:0;max-height:260px;overflow-y:auto;border-top:1px solid #ddd;margin-top:15px}
  #orderQueue li{display:flex;align-items:center;justify-content:space-between;
      padding:10px;border-bottom:1px solid #eee;font-size:1em}
  #orderQueue li.completed{text-decoration:line-through;color:#888}
  .order-info{flex:1}.order-check{margin-left:10px;width:22px;height:22px;cursor:pointer}
  .connection-status{text-align:center;margin-top:5px;font-size:.8em;color:#999}
  .connection-status.online{color:#2e7d32}.connection-status.offline{color:#c62828}
  @media(max-width:600px){
    .container{margin:15px;padding:20px}
    h1{font-size:2em}.coffee-card{width:45%;padding:10px}
    button{font-size:1em;padding:10px}
  }
  </style>
</head>
<body>
  <div class="container">
    <h1>Coffee&nbsp;Shaky</h1>

    <!-- ×‘×—×™×¨×ª ××©×§×” -->
    <div class="coffee-options">
      <div class="coffee-card" data-coffee="Espresso">
        <div class="coffee-icon"><img src="espresso.png" alt="Espresso"></div><p>××¡×¤×¨×¡×•</p>
      </div>
      <div class="coffee-card" data-coffee="Macchiato">
        <div class="coffee-icon">â˜•ï¸</div><p>××§×™××˜×•</p>
      </div>
      <div class="coffee-card" data-coffee="Cappuccino">
        <div class="coffee-icon">â˜•ï¸</div><p>×§×¤×•×¦'×™× ×•</p>
      </div>
      <div class="coffee-card" data-coffee="Americano">
        <div class="coffee-icon">â˜•ï¸</div><p>×××¨×™×§× ×•</p>
      </div>
      <div class="coffee-card" data-coffee="Tea">
        <div class="coffee-icon">ğŸµ</div><p>×ª×”</p>
      </div>
    </div>

    <!-- ×˜×•×¤×¡ ×”×–×× ×” -->
    <form id="orderForm">
      <div class="form-group">
        <label for="userName">×©× ×¤×¨×˜×™:</label>
        <input type="text" id="userName" placeholder="×”×§×œ×“/×™ ××ª ×©××š" required />
      </div>
      <div class="form-group">
        <label for="specialRequest">×‘×§×©×” ××™×•×—×“×ª (×œ× ×—×•×‘×”):</label>
        <textarea id="specialRequest" placeholder="×”×•×¨××•×ª ××™×•×—×“×•×ªâ€¦"></textarea>
      </div>
      <button type="submit">×”×–×× ×ª ××©×§×”</button>
    </form>
    <div id="orderStatus"></div>
    <div id="connectionStatus" class="connection-status">××ª×—×‘×¨â€¦</div>

    <!-- ×¨×©×™××ª ×”×–×× ×•×ª -->
    <h2>×ª×•×¨ ×”×”×–×× ×•×ª</h2>
    <div class="queue-controls">
      <button id="deleteOrdersBtn" class="action-button delete-button">××—×§ ××ª ×›×œ ×”×”×–×× ×•×ª</button>
      <button id="refreshOrdersBtn" class="action-button">×¨×¢× ×Ÿ</button>
    </div>
    <ul id="orderQueue"></ul>
  </div>

  <!-- ------------- JS ------------- -->
  <script type="module">
    /* ---- Firebase modular SDK v11 (31 May 2025) ---- */
    import { initializeApp }   from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, query, orderBy,
      onSnapshot, serverTimestamp, writeBatch, updateDoc, doc
    } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    /* ---- Your project keys (DONâ€™T expose sensitive keys anywhere else) ---- */
    const firebaseConfig = {
      apiKey:             "AIzaSyCVAN11EFH0bSP3GefRvICHyWKMto0-5mc",
      authDomain:         "coffee-shaky.firebaseapp.com",
      projectId:          "coffee-shaky",
      storageBucket:      "coffee-shaky.appspot.com",
      messagingSenderId:  "319501505593",
      appId:              "1:319501505593:web:918b539e4b5cca36b4a9e8"
    };

    /* ---- Init ---- */
    let db;
    try {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      updateConnectionStatus(true);
    } catch (err) {
      console.error(err);
      document.getElementById("orderStatus").textContent = "×©×’×™××” ×‘×—×™×‘×•×¨ ×œ-×©×¨×ª";
      updateConnectionStatus(false);
    }

    /* ---- Beverage names (ENâ†’HE) ---- */
    const beverageNames = {
      Espresso   : "××¡×¤×¨×¡×•",
      Macchiato  : "××§×™××˜×•",
      Cappuccino : "×§×¤×•×¦'×™× ×•",
      Americano  : "×××¨×™×§× ×•",
      Tea        : "×ª×”"
    };

    /* ---- DOM refs ---- */
    const coffeeCards      = document.querySelectorAll(".coffee-card");
    const orderForm        = document.getElementById("orderForm");
    const orderStatus      = document.getElementById("orderStatus");
    const orderQueue       = document.getElementById("orderQueue");
    const deleteOrdersBtn  = document.getElementById("deleteOrdersBtn");
    const refreshOrdersBtn = document.getElementById("refreshOrdersBtn");

    let selectedCoffee = null;

    coffeeCards.forEach(card => {
      card.addEventListener("click", () => {
        coffeeCards.forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        selectedCoffee = card.dataset.coffee;
      });
    });

    /* ---- Submit new order ---- */
    orderForm.addEventListener("submit", async e => {
      e.preventDefault();
      const name = document.getElementById("userName").value.trim();
      const specialRequest = document.getElementById("specialRequest").value.trim();
      if (!name)           { orderStatus.textContent = "×™×© ×œ×”×–×™×Ÿ ×©×";          return; }
      if (!selectedCoffee) { orderStatus.textContent = "×™×© ×œ×‘×—×•×¨ ××©×§×”";        return; }

      try {
        await addDoc(collection(db, "orders"), {
          name,
          beverage:       selectedCoffee,       // stored in EN
          specialRequest,
          timestamp:      serverTimestamp(),
          status:         "pending"
        });
        orderStatus.textContent = "âœ… ×”×”×–×× ×” × ×§×œ×˜×”!";
        orderForm.reset();
        selectedCoffee = null;
        coffeeCards.forEach(c => c.classList.remove("selected"));
      } catch (err) {
        console.error(err);
        orderStatus.textContent = "âŒ ×©×’×™××” ×‘×”×–×× ×”";
        updateConnectionStatus(false);
      }
    });

    /* ---- Delete all orders (admin code: 1707) ---- */
    deleteOrdersBtn.addEventListener("click", async () => {
      const code = prompt("×”×›× ×¡/×™ ×§×•×“ ××—×™×§×”");
      if (code !== "1707") { alert("×§×•×“ ×©×’×•×™"); return; }
      if (!confirm("×‘×˜×•×—/×”?")) return;

      try {
        const snap  = await getDocs(collection(db, "orders"));
        const batch = writeBatch(db);
        snap.forEach(d => batch.delete(d.ref));
        await batch.commit();
        alert(`× ××—×§×• ${snap.size} ×”×–×× ×•×ª`);
      } catch (err) {
        console.error(err);
        alert("×©×’×™××” ×‘××—×™×§×”");
      }
    });

    /* ---- Manual refresh ---- */
    refreshOrdersBtn.addEventListener("click", async () => {
      const snap = await getDocs(query(collection(db, "orders"), orderBy("timestamp", "desc")));
      renderQueue(snap);
    });

    /* ---- Live listener ---- */
    onSnapshot(
      query(collection(db, "orders"), orderBy("timestamp", "desc")),
      snap   => { renderQueue(snap); updateConnectionStatus(true); },
      _error => { orderQueue.innerHTML = "<li>×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×</li>"; updateConnectionStatus(false); }
    );

    /* ---- UI helpers ---- */
    function renderQueue(snap) {
      orderQueue.innerHTML = "";
      if (snap.empty) {
        orderQueue.innerHTML = "<li>××™×Ÿ ×”×–×× ×•×ª ×›×¨×’×¢</li>";
        return;
      }
      snap.forEach(d => {
        const o  = d.data();
        const li = document.createElement("li");
        if (o.status === "completed") li.classList.add("completed");

        const info = document.createElement("span");
        info.className = "order-info";
        const time = o.timestamp ? o.timestamp.toDate().toLocaleTimeString("he-IL", {hour: "2-digit", minute: "2-digit"}) : "â†º";
        const coffee = beverageNames[o.beverage] || o.beverage;
        info.textContent = `${time} â€“ ${o.name}: ${coffee}${o.specialRequest ? " (×‘×§×©×”: " + o.specialRequest + ")" : ""}`;
        li.appendChild(info);

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.className = "order-check";
        cb.checked = o.status === "completed";
        cb.addEventListener("change", () => updateDoc(doc(db, "orders", d.id), { status: cb.checked ? "completed" : "pending" }));
        li.appendChild(cb);

        orderQueue.appendChild(li);
      });
    }

    function updateConnectionStatus(ok) {
      const el = document.getElementById("connectionStatus");
      el.textContent = ok ? "××—×•×‘×¨" : "×× ×•×ª×§";
      el.className   = `connection-status ${ok ? "online" : "offline"}`;
    }
  </script>
</body>
</html>